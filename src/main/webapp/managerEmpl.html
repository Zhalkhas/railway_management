<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage Employee</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"> </script>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
</head>

<body>

<div class="w3-container w3-center w3-margin">
    <h1 >Manage Employee</h1>
</div>

<div class="w3-container w3-left w3-margin-top">
    <h2 class="w3-wide">Employee Table</h2>
</div>

<div>
    <table class="w3-table w3-bordered w3-margin-top">

        <tr >
            <th class="w3-center w3-text-black">EmployeeID</th>
            <th class="w3-center w3-text-black">Name</th>
            <th class="w3-center w3-text-black">Surname</th>
            <th class="w3-center w3-text-black">Role</th>
            <th class="w3-center w3-text-black">Start of Work</th>
            <th class="w3-center w3-text-black">End of Work</th>
<!--            <th class="w3-center w3-text-black">Hours per week</th>-->
            <th class="w3-center w3-text-black">Salary</th>
            <th class="w3-center w3-text-black">Station</th>
        </tr>

        <tbody id="tableEmployee">

        </tbody>
    </table>

</div>

<div>

    <h2 class="w3-wide w3-margin">Change </h2>

        <input type="text" id="emplId" name="emplId" placeholder="Employee ID" class="w3-margin">
        <input type="text" id="emplName" name="emplName" placeholder="Name" class="w3-margin">

        <input type="text" id="emplSurname" name="emplSurname" placeholder="Surname"  class="w3-margin">
        <input type="text" id="role" name="role" placeholder="Role"  class="w3-margin">
        <input type=text  id="startWork"  name="startWork" placeholder="Work Starts" class="w3-margin">
        <input type=text id="endWork"  name="endWork" placeholder="Work Ends" class="w3-margin">



<!-- <input type="text" id="hoursPerWeek" name="hoursPerWeek" placeholder="Work hours Per Week"  class="w3-margin">-->

        <input type="text" id="salary" name="salary" placeholder="Salary" class="w3-margin">

        <input type="text" id="station" name="station" placeholder="Station Name" class="w3-margin">

    </form>


    <button class = "w3-margin-bottom" type="button" id="updateEmployee_button"  onclick="updateEmployee() "  >Change  </button>


</div>

<div>

    <button id="managerStart_button" class="closing" onClick="window.location.href = 'ManagerStart.html';" >Manager Main Page</button>

</div>

<script>

    var methodName="";
    function updateTable(items) {
        document.getElementById("tableEmployee").innerHTML = "";
        $("#table_of_employee tbody tr").remove();
        $("#table_of_employee").html("");
        items = JSON.parse(items);

        items.forEach(function (index) {
            var emplId = index.emplId
            var emplName = index.emplName;
            var emplSurname = index.emplSurname;
            var role = index.role;
            var startWork = index.startWork;
            var endWork = index.endWork;
            // var hoursPerWeek = index.hoursPerWeek;
            var salary = index.salary;
            var station = index.station;



            $("#tableEmployee").append("<tr><td class=\"column1\">"

                + emplId + "</td><td class=\"column2\">"
                + emplName + "</td><td class=\"column3\">"
                + emplSurname + "</td><td class=\"column4\">"
                + role + "</td><td class=\"column5\">"
                + startWork + "</td><td class=\"column6\">"
                + endWork + "</td><td class=\"column7\">"
                // + hoursPerWeek + "</td><td class=\"column7\">"
                + salary + "</td><td class=\"column8\">"
                + station + "</td><td class=\"column9\"></td>"
                +  "<button type='button' id='updateEmployee_button' onclick='update(" + employeeId + ")'>Update</button>"
                + "<br></tr><br>");


        });
    }

    function getEmployeeFunction() {
        $.ajax({
            url : 'api/manager/employees',
            dataType : 'json',
            success : function(r) {
                updateTable(r);
            }
        });
    }

    function updateEmployee() {

        var emplId = $('#emplId').val();
        var emplName = $('#emplName').val();
        var emplSurname = $('#emplSurname').val();
        var role = $('#role').val();
        var startWork = $('#startWork').val();
        var endWork = $('#endWork').val();
        var salary = $('#salary').val();
        var station = $('#station').val();

        if(emplName.match("\\w+") && emplSurname.match("\\w+") && role.match("\\w+")
            && startWork.match("\\w+") && endWork.match("\\w+") && salary.match("\\w+") && station.match("\\w+")){
            $.ajax({
                url: "api/manager/changeEmployee",
                data: {
                    emplId: emplId,
                    emplName: emplName,
                    emplSurname: emplSurname,
                    role: role,
                    start: startWork,
                    end: endWork,
                    salary: salary,
                    station: station
                },
                method: methodName,
                contentType: 'application/x-www-form-urlencoded'
            }).done(function (r) {
                // getEmployeeFunction();
                if(r.status>=400) {
                    alert("Check the values entered, please");
                }else{
                    getEmployeeFunction();
                    reset();
                }
            });

        } else {
            alert('Enter values to all fields, please');
        }
    }

    function update(employeeId){
        $.ajax({

            method: 'GET',
            dataType: 'json',

            success: function (index) {
                $('#emplId').val(index.emplId);
                $('#emplName').val(index.emplName);
                $('#emplSurname').val(index.emplSurname);
                $('#role').val(index.role);
                $('#salary').val(index.salary);
                $('#startWork').val(index.start);
                $('#endWork').val(index.end);
                $('#station').val(index.station);
                getEmployeeFunction();
            },
            error: function (error) {
                alert(error);
            }
        })
    }

    function reset(){


        $('#emplId').val(' ');
       $('#emplName').val(' ');
         $('#emplSurname').val(' ');
        $('#role').val(' ');
       $('#startWork').val(' ');
         $('#endWork').val(' ');
        $('#salary').val(' ');
         $('#station').val(' ');
    }

    $(document).ready(function (){
        getEmployeeFunction();

        $("#updateEmployee_button").on('click', function () {
            var emplId = $('#emplId').val();


            if(emplId){
                //update it

                methodName = "PUT";
                updateEmployee();
            }else{
                //save it

                methodName = "POST";
                updateEmployee();
            }

        });

    });


</script>



</body>
</html>